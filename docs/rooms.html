<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rooms - Laurier Navigator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="topbar">
    <div class="logo">WalkingBuddy Rooms</div>
    <nav class="nav-links">
      <a href="index.html">Navigation</a>
      <a href="rooms.html" class="active">Rooms</a>
    </nav>
  </header>

  <main class="rooms-container">
    <h1 class="section-title">Available Rooms</h1>

    <!-- This will show if no rooms are available -->
    <div id="no-rooms-message" class="no-rooms-message">
      <p>No rooms available. Create one!</p>
    </div>

    <!-- List of rooms (dynamically populated) -->
    <div id="room-list" class="room-list">
      <!-- Room cards will be added here dynamically -->
    </div>

    <!-- Button to toggle Create Room Form -->
    <button id="toggle-create-room-form" class="btn primary-outline">Create New Room</button>

    <!-- Create Room Form (hidden initially) -->
    <div id="create-room-form" class="create-room-form" style="display:none;">
      <h2>Create a New Room</h2>
      <label class="input-label">Room Name</label>
      <input id="room-name" class="text-input" placeholder="Enter room name" />

      <label class="input-label">Meet Time</label>
      <input id="meet-time" class="text-input" type="datetime-local" />

      <label class="input-label">Start Location</label>
      <input id="start-location" class="text-input" placeholder="Start location" />

      <label class="input-label">Destination</label>
      <input id="destination" class="text-input" placeholder="Destination" />

      <button id="btn-create-room" class="btn primary">Create Room</button>
    </div>
  </main>

  <script>
    // Get rooms from localStorage (if any)
    let rooms = JSON.parse(localStorage.getItem("rooms")) || [];

    // Function to render rooms
    function renderRooms() {
      const roomList = document.getElementById("room-list");
      const noRoomsMessage = document.getElementById("no-rooms-message");

      if (rooms.length === 0) {
        noRoomsMessage.style.display = "block"; // Show "No rooms" message
      } else {
        noRoomsMessage.style.display = "none"; // Hide the "no rooms" message
        roomList.innerHTML = ""; // Clear the list before re-rendering

        rooms.forEach(room => {
          const roomCard = document.createElement("div");
          roomCard.classList.add("room-card");

          roomCard.innerHTML = `
            <h3 class="room-title">${room.name}</h3>
            <div class="room-meta">
              <p><strong>Members:</strong> ${room.members}</p>
              <p><strong>Meeting Time:</strong> ${new Date(room.meetTime).toLocaleString()}</p>
              <p><strong>Start Location:</strong> ${room.startLocation}</p>
              <p><strong>Destination:</strong> ${room.destination}</p>
            </div>
            <button class="btn secondary" onclick="joinRoom('${room.name}')">Join Room</button>
            <button class="btn outline" onclick="deleteRoom('${room.name}')">Delete Room</button>
          `;
          
          roomList.appendChild(roomCard);
        });
      }
    }

    // Handle room creation and saving to localStorage
    document.getElementById("btn-create-room").addEventListener("click", function() {
      const roomName = document.getElementById("room-name").value.trim();
      const meetTime = document.getElementById("meet-time").value;
      const startLocation = document.getElementById("start-location").value.trim();
      const destination = document.getElementById("destination").value.trim();

      // Form validation
      if (!roomName || !meetTime || !startLocation || !destination) {
        alert("Please fill in all fields.");
        return;
      }

      // Create new room object
      const newRoom = {
        name: roomName,
        meetTime: meetTime,
        startLocation: startLocation,
        destination: destination,
        members: 1, // Start with 1 member (the creator)
      };

      // Add the new room to rooms array
      rooms.push(newRoom);

      // Save the updated rooms list to localStorage
      localStorage.setItem("rooms", JSON.stringify(rooms));

      // Reload the rooms list
      renderRooms();

      // Hide the form after creating room
      document.getElementById("create-room-form").style.display = "none";
    });

    // Handle room joining
    function joinRoom(roomName) {
      const room = rooms.find(r => r.name === roomName);
      if (room) {
        room.members += 1; // Increase member count when joining

        // Save the updated rooms to localStorage
        localStorage.setItem("rooms", JSON.stringify(rooms));

        // Save the current room data for the user (can be used in the chat page)
        localStorage.setItem("currentRoom", JSON.stringify(room));

        // Redirect to the chat page
        window.location.href = "chat.html";
      }
    }

    // Handle room deletion
    function deleteRoom(roomName) {
      const roomIndex = rooms.findIndex(r => r.name === roomName);
      if (roomIndex > -1) {
        rooms.splice(roomIndex, 1); // Remove the room from the list

        // Update rooms in localStorage
        localStorage.setItem("rooms", JSON.stringify(rooms));

        // Re-render the rooms list
        renderRooms();
      }
    }

    // Toggle Create Room Form visibility
    document.getElementById("toggle-create-room-form").addEventListener("click", function() {
      const form = document.getElementById("create-room-form");
      if (form.style.display === "none") {
        form.style.display = "block"; // Show the form
      } else {
        form.style.display = "none"; // Hide the form
      }
    });

    // Render rooms on page load
    renderRooms();
  </script>

</body>
</html>
